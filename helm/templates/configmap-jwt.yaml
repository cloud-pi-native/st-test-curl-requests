apiVersion: v1
kind: ConfigMap
metadata:
  name: st-test-nginx-config-advanced
data:

  # nginx script
  kubernetescurljob.sh: |
    #!/bin/env sh

    echo "##########"
    echo "get JWT token"
    echo "##########"

    JWT_TOKEN=`curl --location --request POST $JWT_TOKEN_URL --header 'Content-Type: application/x-www-form-urlencoded' --data 'grant_type=client_credentials&scope=releve_information_integral:read' -k --user "$JWT_USER:$JWT_PASSWORD" | jq -r '.access_token'`
    echo "##########"
    echo "token : $JWT_TOKEN"
    echo "##########"

    echo "##########"
    echo "Appel Ã  travers INES avec le token JWT"
    echo "##########"

    curl $CURL_OPTIONS "Token: $TOKEN" -H 'accept: application/json' -H "Authorization: Bearer $JWT_TOKEN" $URL/$ID_DOSSIER --cert /tmp/full_cert.pem

    echo "##########"
    echo "fin appel INES"
    echo "##########"



